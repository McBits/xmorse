function Notify(e,t){document.dispatchEvent(new CustomEvent(e,{detail:t}))}function Listen(e,t){document.addEventListener(e,function(e){return t(e.detail)})}function Query(e,t){return(t||document).querySelector(e)}function QueryAll(e,t){return(t||document).querySelectorAll(e)}function QueryId(e){return document.getElementById(e)}var AudioCtx=new(AudioContext||window.webkitAudioContext),MasterGain=AudioCtx.createGain();MasterGain.gain.value=.5,MasterGain.connect(AudioCtx.destination);var LETTER="letter",NOW_PLAYING="nowPlaying",OUTPUT="output",OSC_OFF="toneOff",OSC_ON="toneOn",PATTERN_START="patternStart",PATTERN_STOP="patternStop",PAUSE="pause",START="start",STORY="book",STOP="stop",SET_SPACING="set_spacing",SET_FLASHING_ENABLED="set_flashing",SET_LETTERS="set_letters",SET_NUMBERS="set_numbers",SET_PITCH="set_pitch",SET_SYMBOLS="set_symbols",SET_TEXT_BUFFER="set_textBuffer",SET_VOICE="set_voice",SET_VOLUME="set_volume",SET_WPM="set_wpm",UI_SPACING="ui_spacing",UI_FLASHING="ui_flashing",UI_LETTERS="ui_letters",UI_NUMBERS="ui_numbers",UI_PITCH="ui_pitch",UI_SYMBOLS="ui_symbols",UI_TEXT_BUFFER="ui_textBuffer",UI_VOICE="ui_voice",UI_VOLUME="ui_volume",UI_WPM="ui_wpm",VIEW_HOME="view_home",VIEW_OPTIONS="view_options",VIEW_PLAYING="view_player",VIEW_STORIES="view_stories",VIEW_TEXT="view_text",VOICE_DONE="voiceDone",WATCH="watch",FullScreen;!function(e){function t(){T.textContent="Full screen",document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}function n(){T.textContent="Exit full screen",document.fullscreenEnabled?L.requestFullscreen():document.webkitFullscreenEnabled?L.webkitRequestFullscreen():document.mozFullScreenEnabled&&L.mozRequestFullScreen()}function r(){g?t():n()}function a(){g=!g,y=Date.now()}function i(){y=Date.now()}function o(){return g&&Date.now()-y>b?(s(),void u()):(c(),void l())}function u(){N&&(L.style.cursor="none"),N=!1}function l(){N||(L.style.cursor="default"),N=!0}function s(){I&&(T.classList.add("disabled"),_.classList.add("disabled"),v.classList.add("disabled"),p.classList.add("disabled")),I=!1}function c(){I||(T.classList.remove("disabled"),_.classList.remove("disabled"),v.classList.remove("disabled"),p.classList.remove("disabled")),I=!0}function E(){document.addEventListener("mousemove",i),S=setInterval(o,200)}function d(){clearInterval(S),document.removeEventListener("mousemove",i),l(),c(),g&&t()}var S,T=Query(".btn-fullscreen"),f=Query(".btn-start"),m=Query(".btn-stop"),L=document.body.parentElement,_=Query(".controls"),v=Query(".menu"),p=Query(".sidebar"),g=!1,y=Date.now(),b=2e3,I=!1,N=!1;f.addEventListener("click",E),m.addEventListener("click",d),document.fullscreenEnabled?document.addEventListener("fullscreenchange",a):document.webkitFullscreenEnabled?document.addEventListener("webkitfullscreenchange",a):document.mozFullScreenEnabled&&document.addEventListener("mozfullscreenchange",a),T.addEventListener("click",r)}(FullScreen||(FullScreen={}));var Morse;!function(e){function t(){var e=[];if(E&&(e=e.concat(l)),d&&(e=e.concat(s)),S&&(e=e.concat(c)),e.length>0){var t=e[Math.floor(Math.random()*e.length)];return a[t]||i[t]||o[t]}return null}function n(e){e=e.toUpperCase();var t=a[e];return t?t:(t=i[e])?t:(t=o[e],t?t:void 0)}function r(e){var t=u[e.name];return t||(t=e.name),t+=".mp3"}var a={A:{name:"A",pattern:".-"},B:{name:"B",pattern:"-..."},C:{name:"C",pattern:"-.-."},D:{name:"D",pattern:"-.."},E:{name:"E",pattern:"."},F:{name:"F",pattern:"..-."},G:{name:"G",pattern:"--."},H:{name:"H",pattern:"...."},I:{name:"I",pattern:".."},J:{name:"J",pattern:".---"},K:{name:"K",pattern:"-.-"},L:{name:"L",pattern:".-.."},M:{name:"M",pattern:"--"},N:{name:"N",pattern:"-."},O:{name:"O",pattern:"---"},P:{name:"P",pattern:".--."},Q:{name:"Q",pattern:"--.-"},R:{name:"R",pattern:".-."},S:{name:"S",pattern:"..."},T:{name:"T",pattern:"-"},U:{name:"U",pattern:"..-"},V:{name:"V",pattern:"...-"},W:{name:"W",pattern:".--"},X:{name:"X",pattern:"-..-"},Y:{name:"Y",pattern:"-.--"},Z:{name:"Z",pattern:"--.."}},i={0:{name:"0",pattern:"-----"},1:{name:"1",pattern:".----"},2:{name:"2",pattern:"..---"},3:{name:"3",pattern:"...--"},4:{name:"4",pattern:"....-"},5:{name:"5",pattern:"....."},6:{name:"6",pattern:"-...."},7:{name:"7",pattern:"--..."},8:{name:"8",pattern:"---.."},9:{name:"9",pattern:"----."}},o={".":{name:".",pattern:".-.-.-"},"?":{name:"?",pattern:"..--.."},"!":{name:"!",pattern:"-.-.--"},",":{name:",",pattern:"--..--"},":":{name:":",pattern:"---..."},";":{name:";",pattern:"-.-.-."},"'":{name:"'",pattern:".----."},"-":{name:"-",pattern:"-....-"},"/":{name:"/",pattern:"-..-."},"(":{name:"(",pattern:"-.--."},")":{name:")",pattern:"-.--.-"},"@":{name:"@",pattern:".--.-."},"=":{name:"=",pattern:"-...-"},"+":{name:"+",pattern:".-.-."},'"':{name:'"',pattern:".-..-."}},u={".":"PERIOD","?":"QUESTION","!":"EXCLAMATION",",":"COMMA",":":"COLON",";":"SEMICOLON","'":"APOSTROPHE","-":"DASH","/":"SLASH","(":"OPEN_BRACKET",")":"CLOSE_BRACKET","@":"AT","=":"EQUALS","+":"PLUS",'"':"QUOTE"},l=Object.keys(a),s=Object.keys(i),c=Object.keys(o),E=!0,d=!1,S=!1;e.RandomCharacter=t,e.GetCharacter=n,e.fileName=r,Listen(SET_LETTERS,function(e){return E=e}),Listen(SET_NUMBERS,function(e){return d=e}),Listen(SET_SYMBOLS,function(e){return S=e})}(Morse||(Morse={}));var Timing;!function(e){Listen(NOW_PLAYING,function(t){return e.NowPlaying=t}),Listen(SET_WPM,function(t){return e.UnitTime=1.2/t*1e3}),Listen(SET_SPACING,function(t){return e.CharSpacing=t})}(Timing||(Timing={}));var TonePlayer;!function(e){function t(){s.gain.setTargetAtTime(o,AudioCtx.currentTime+i,u),Notify(OSC_ON,null)}function n(){s.gain.setTargetAtTime(0,AudioCtx.currentTime+i,u),Notify(OSC_OFF,null)}function r(e){Notify(PATTERN_START,e.pattern),Notify(LETTER,"");for(var r=0,i=0;i<e.pattern.length;++i){var o="."===e.pattern[i]?1:3;setTimeout(t,r),r+=a.UnitTime*o,setTimeout(n,r),r+=a.UnitTime}setTimeout(function(){return Notify(PATTERN_STOP,e)},r-a.UnitTime)}var a=Timing,i=navigator.userAgent.indexOf("irefox")!==-1?.05:0,o=.9,u=.004,l=AudioCtx.createOscillator(),s=AudioCtx.createGain();s.gain.setValueAtTime(0,AudioCtx.currentTime),l.connect(s),s.connect(MasterGain),l.start(0),e.PlayPattern=r,Listen(SET_PITCH,function(e){return l.frequency.value=e})}(TonePlayer||(TonePlayer={}));var Xhr;!function(e){function t(e,t,n){var r=new XMLHttpRequest;r.responseType=t,r.onload=function(){200===r.status?n(r.response):console.log("Sever request failed: ",r)},r.onerror=function(){console.log("Server request failed: ",r)},r.open("GET",e),r.send()}e.Load=t}(Xhr||(Xhr={}));var VoicePlayer;!function(e){function t(e){var t=E;E=!1,t&&i(e)}function n(e,t){return function(n){AudioCtx.decodeAudioData(n,function(n){o[e.name]=n,s[e.name]=!1,c[e.name]=!0,t(e)},function(e){return console.log("Error loading audio source: ",e)})}}function r(e){c[e.name]?t(e):(s[e.name]=!0,Xhr.Load("/snd/"+Morse.fileName(e),"arraybuffer",n(e,t)))}function a(e){l&&!c[e.name]&&s[e.name]&&r(e)}function i(e){if(Timing.NowPlaying)if(l)if(s[e.name])E=!0;else if(c[e.name]){var t=o[e.name],n=AudioCtx.createBufferSource();n.addEventListener("ended",function(){return Notify(VOICE_DONE,e)}),n.buffer=t,n.connect(u),n.start(0)}else E=!0,r(e);else Notify(VOICE_DONE,e)}var o={},u=AudioCtx.createGain();u.gain.value=.85,u.connect(MasterGain);var l=!1,s={},c={},E=!1;e.PreloadVoice=a,e.PlayVoice=i,Listen(SET_VOICE,function(e){return l=e})}(VoicePlayer||(VoicePlayer={}));var TextLoader;!function(e){function t(){o=i.length>0?0:-1}function n(e){i=e.toUpperCase()+"\n",t()}function r(e){Xhr.Load(e,"text",function(e){Notify(SET_TEXT_BUFFER,e),Notify(START,null)})}function a(){if(i.length>0){var e=o,t="";do{t+=i[o];var n=Morse.GetCharacter(i[o]);if(++o,o===i.length&&(o=0),n)return[t,n]}while(o!==e);return["",null]}var r=Morse.RandomCharacter();return[r.name,r]}var i="",o=-1;e.Next=a,Listen(SET_TEXT_BUFFER,n),Listen(STORY,r),Listen(STOP,t)}(TextLoader||(TextLoader={}));var Player;!function(e){function t(){if(o.NowPlaying){var e=TextLoader.Next();if(e[1]){var t=0;e[0]!==e[1].name&&(Notify(OUTPUT,e[0].substr(0,e[0].length-1)),Notify(PATTERN_START," "),Notify(LETTER,""),t=o.UnitTime*o.CharSpacing*(7/3)),setTimeout(function(){var t=e[1];VoicePlayer.PreloadVoice(t),TonePlayer.PlayPattern(t)},t)}else Notify(PATTERN_START,""),Notify(PATTERN_STOP,null)}}function n(e){MasterGain.gain.setTargetAtTime(e,AudioCtx.currentTime,.01)}function r(){o.NowPlaying||(Notify(NOW_PLAYING,!0),setTimeout(t,500))}function a(){Notify(NOW_PLAYING,!1)}function i(e){o.NowPlaying&&(null==e?setTimeout(t,o.UnitTime*o.CharSpacing):(Notify(LETTER,e.name),setTimeout(function(){return VoicePlayer.PlayVoice(e)},o.UnitTime*o.CharSpacing)))}var o=Timing;Listen(VOICE_DONE,t),Listen(PAUSE,a),Listen(STOP,a),Listen(START,r),Listen(PATTERN_STOP,i),Listen(SET_VOLUME,n)}(Player||(Player={}));var Routing;!function(e){function t(){var e=location.hash;n[e]&&Notify(n[e],null),""===e&&location.href.indexOf("#")>-1&&history.replaceState("",document.title,window.location.pathname)}var n={"":VIEW_HOME,"#playing":VIEW_PLAYING,"#options":VIEW_OPTIONS,"#stories":VIEW_STORIES,"#text":VIEW_TEXT};window.addEventListener("hashchange",t),document.addEventListener("DOMContentLoaded",t)}(Routing||(Routing={}));var LocalStorage;!function(e){Listen(UI_SPACING,function(e){return localStorage.setItem("charSpacing",e)}),Listen(UI_FLASHING,function(e){return localStorage.setItem("flashingEnabled",e.toString())}),Listen(UI_LETTERS,function(e){return localStorage.setItem("lettersEnabled",e.toString())}),Listen(UI_NUMBERS,function(e){return localStorage.setItem("numbersEnabled",e.toString())}),Listen(UI_PITCH,function(e){return localStorage.setItem("pitch",e)}),Listen(UI_SYMBOLS,function(e){return localStorage.setItem("symbolsEnabled",e.toString())}),Listen(UI_TEXT_BUFFER,function(e){return localStorage.setItem("textBuffer",e.toString())}),Listen(UI_VOICE,function(e){return localStorage.setItem("voiceEnabled",e.toString())}),Listen(UI_VOLUME,function(e){return localStorage.setItem("volume",e)}),Listen(UI_WPM,function(e){return localStorage.setItem("wpm",e)})}(LocalStorage||(LocalStorage={}));var UI;!function(e){var t=(Query(".btn-home"),QueryAll(".btn-start")),n=Query(".btn-start"),r=Query(".btn-pause"),a=Query(".btn-stop"),i=Query(".letter"),o=Query(".outputBuffer"),u=QueryAll(".story a");r.addEventListener("click",function(){return Notify(PAUSE,null)});for(var l=0;l<t.length;++l)t[l].addEventListener("click",function(){return Notify(START,null)});a.addEventListener("click",function(){return Notify(STOP,null)});for(var l=0;l<u.length;++l){var s=u[l];s.addEventListener("click",function(e){e.preventDefault();var t=e.target,n=t.href;Notify(STORY,n)})}Listen(PAUSE,function(){n.disabled=!1,r.disabled=!0,a.disabled=!0}),Listen(START,function(){Notify(WATCH,null),n.disabled=!0,r.disabled=!1,a.disabled=!1}),Listen(STOP,function(){location.hash="",o.innerHTML="",i.innerHTML="",n.disabled=!1,r.disabled=!0,a.disabled=!0}),Listen(LETTER,function(e){return i.innerHTML=e}),Listen(OUTPUT,function(e){o.innerHTML+=e,o.scrollTop=o.scrollHeight}),Listen(PATTERN_START,function(e){function t(e){var t=document.createElement("span");return t.classList.add("element"),t.classList.add(e),t}for(var n=document.querySelector(".view.playing .pattern"),r=0;r<e.length;++r){var a=void 0;"."===e[r]?a=t("dit"):"-"===e[r]?a=t("dah"):" "===e[r]&&(a=t("wordSpace")),n.appendChild(a)}n.appendChild(t("charSpace"))}),Listen(PATTERN_STOP,function(e){o.innerHTML+=null==e?" ":e.name,o.scrollTop=o.scrollHeight}),Listen(OSC_OFF,function(){return Query("body").classList.remove("toneOn")}),Listen(OSC_ON,function(){Settings.userSet.flashingEnabled.checked&&Query("body").classList.add("toneOn")}),Listen(WATCH,function(){return location.hash="#playing"})}(UI||(UI={}));var Settings;!function(e){function t(e,t){Notify("manual_"+e,t.toString()),Notify(e,t)}var n=QueryId("resetSettings"),r=Query(".volumeText"),a=Query(".charWPMText"),i=Query(".pitchText"),o=Query(".charSpacingText");e.userSet={volume:QueryId("volume"),charWPM:QueryId("charWPM"),pitch:QueryId("pitch"),charSpacing:QueryId("charSpacing"),voiceEnabled:QueryId("voiceEnabled"),pasteTextBox:QueryId("pasteText"),flashingEnabled:QueryId("flashingEnabled"),lettersEnabled:QueryId("lettersEnabled"),numbersEnabled:QueryId("numbersEnabled"),symbolsEnabled:QueryId("symbolsEnabled")};var u={charSpacing:12,flashingEnabled:!1,lettersEnabled:!0,numbersEnabled:!1,pitch:650,symbolsEnabled:!1,voiceEnabled:!0,volume:.4,wpm:15};e.userSet.volume.addEventListener("input",function(){return t(SET_VOLUME,parseFloat(e.userSet.volume.value))}),e.userSet.charWPM.addEventListener("input",function(){return t(SET_WPM,parseInt(e.userSet.charWPM.value))}),e.userSet.charSpacing.addEventListener("input",function(){return t(SET_SPACING,parseInt(e.userSet.charSpacing.value))}),e.userSet.pitch.addEventListener("input",function(){return t(SET_PITCH,parseInt(e.userSet.pitch.value))}),e.userSet.pasteTextBox.addEventListener("input",function(){return t(SET_TEXT_BUFFER,e.userSet.pasteTextBox.value)}),e.userSet.voiceEnabled.addEventListener("change",function(){return t(SET_VOICE,e.userSet.voiceEnabled.checked)}),e.userSet.flashingEnabled.addEventListener("change",function(){return t(SET_FLASHING_ENABLED,e.userSet.flashingEnabled.checked)}),e.userSet.lettersEnabled.addEventListener("change",function(){return t(SET_LETTERS,e.userSet.lettersEnabled.checked)}),e.userSet.numbersEnabled.addEventListener("change",function(){return t(SET_NUMBERS,e.userSet.numbersEnabled.checked)}),e.userSet.symbolsEnabled.addEventListener("change",function(){return t(SET_SYMBOLS,e.userSet.symbolsEnabled.checked)}),n.addEventListener("click",function(){t(SET_SPACING,u.charSpacing),t(SET_FLASHING_ENABLED,u.flashingEnabled),t(SET_LETTERS,u.lettersEnabled),t(SET_NUMBERS,u.numbersEnabled),t(SET_PITCH,u.pitch),t(SET_SYMBOLS,u.symbolsEnabled),t(SET_VOICE,u.voiceEnabled),t(SET_VOLUME,u.volume),t(SET_WPM,u.wpm)}),Listen(SET_SPACING,function(t){o.value=t.toString(),e.userSet.charSpacing.value=t.toString()}),Listen(SET_FLASHING_ENABLED,function(t){return e.userSet.flashingEnabled.checked=t}),Listen(SET_LETTERS,function(t){return e.userSet.lettersEnabled.checked=t}),Listen(SET_NUMBERS,function(t){return e.userSet.numbersEnabled.checked=t}),Listen(SET_PITCH,function(t){i.value=t.toString(),e.userSet.pitch.value=t.toString()}),Listen(SET_SYMBOLS,function(t){return e.userSet.symbolsEnabled.checked=t}),Listen(SET_TEXT_BUFFER,function(t){return e.userSet.pasteTextBox.value=t}),Listen(SET_VOICE,function(t){return e.userSet.voiceEnabled.checked=t}),Listen(SET_VOLUME,function(t){r.value=Math.floor(100*t).toString(),e.userSet.volume.value=t.toString()}),Listen(SET_WPM,function(t){a.value=t.toString(),e.userSet.charWPM.value=t.toString()}),document.addEventListener("DOMContentLoaded",function(){Notify(SET_VOLUME,localStorage.getItem("volume")||u.volume),Notify(SET_WPM,localStorage.getItem("wpm")||u.wpm),Notify(SET_SPACING,localStorage.getItem("charSpacing")||u.charSpacing),Notify(SET_PITCH,localStorage.getItem("pitch")||u.pitch);var e=localStorage.getItem("voiceEnabled");null==e?Notify(SET_VOICE,u.voiceEnabled):Notify(SET_VOICE,"true"===e);var t=localStorage.getItem("flashingEnabled");null==t?Notify(SET_FLASHING_ENABLED,u.flashingEnabled):Notify(SET_FLASHING_ENABLED,"true"===t);var n=localStorage.getItem("lettersEnabled");null==n?Notify(SET_LETTERS,u.lettersEnabled):Notify(SET_LETTERS,"true"===n);var r=localStorage.getItem("numbersEnabled");null==r?Notify(SET_NUMBERS,u.numbersEnabled):Notify(SET_NUMBERS,"true"===r);var a=localStorage.getItem("symbolsEnabled");null==a?Notify(SET_SYMBOLS,u.symbolsEnabled):Notify(SET_SYMBOLS,"true"===a)})}(Settings||(Settings={}));var Views;!function(e){function t(e,t){for(var n=QueryAll(".view"),r=0;r<n.length;++r){var a=n[r];a.classList.contains("disabled")||a.classList.add("disabled")}var i=Query(e);i.classList.remove("disabled");for(var o=QueryAll(".menu .btn"),r=0;r<o.length;++r){var u=o[r];u.classList.remove("active")}t.classList.add("active")}Listen(VIEW_HOME,function(){return t(".home",Query(".btn-home"))}),Listen(VIEW_OPTIONS,function(){return t(".options",Query(".btn-options"))}),Listen(VIEW_PLAYING,function(){return t(".playing",Query(".btn-playing"))}),Listen(VIEW_STORIES,function(){return t(".stories",Query(".btn-stories"))}),Listen(VIEW_TEXT,function(){return t(".paste",Query(".btn-paste"))})}(Views||(Views={}));
//# sourceMappingURL=app.js.map
